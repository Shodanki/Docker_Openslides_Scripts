diff
###############################################
# Patch for install_openslides.sh
###############################################
--- install_openslides.sh.orig
+++ install_openslides.sh
@@ After processing command line options, add the installation directory selection:
+## Level 1: Installation Directory Selection
+echo "Choose installation directory:"
+echo "1) Default (/opt/openslides)"
+echo "2) Custom directory"
+echo "3) Script execution directory appended with /openslides"
+read -rp "Enter your choice (1-3): " dir_choice
+case $dir_choice in
+    1)
+        INSTALL_DIR="/opt/openslides"
+        ;;
+    2)
+        read -rp "Enter custom installation directory: " custom_dir
+        INSTALL_DIR="$custom_dir"
+        ;;
+    3)
+        SCRIPT_EXEC_DIR=$(dirname "$(realpath "$0")")
+        INSTALL_DIR="$SCRIPT_EXEC_DIR/openslides"
+        ;;
+    *)
+        echo "Invalid choice. Using default (/opt/openslides)."
+        INSTALL_DIR="/opt/openslides"
+        ;;
+esac
+export INSTALL_DIR
+echo "Installation directory set to: $INSTALL_DIR"
 
 
###############################################
# Patch for configuration_utils.sh
###############################################
--- configuration_utils.sh.orig
+++ configuration_utils.sh
@@ At the top, add a check for INSTALL_DIR and update log directory:
+INSTALL_DIR=${INSTALL_DIR:-/opt/openslides}
-# Log directory and file location
-SCRIPT_DIR=$(dirname "$(realpath "$0")")
-LOG_DIR="$SCRIPT_DIR/logs"
+LOG_DIR="$INSTALL_DIR/logs"
@@ In functions, replace hardcoded path with $INSTALL_DIR:
-  local compose_file="/opt/openslides/docker-compose.yml"
+  local compose_file="$INSTALL_DIR/docker-compose.yml"
 
###############################################
# Patch for health_check.sh
###############################################
--- health_check.sh.orig
+++ health_check.sh
@@ At the top, add:
+INSTALL_DIR=${INSTALL_DIR:-/opt/openslides}
-# Log directory and file location
-SCRIPT_DIR=$(dirname "$(realpath "$0")")
-LOG_DIR="$SCRIPT_DIR/logs"
+LOG_DIR="$INSTALL_DIR/logs"
@@ In functions, replace all occurrences of "/opt/openslides" with "$INSTALL_DIR"
-  if [ ! -f "/opt/openslides/secrets/manage_auth_password" ]; then
+  if [ ! -f "$INSTALL_DIR/secrets/manage_auth_password" ]; then
@@ Similarly update mkdir and file creation paths.
-    mkdir -p /opt/openslides/secrets || {
+    mkdir -p "$INSTALL_DIR/secrets" || {
 
###############################################
# Patch for core_setup.sh
###############################################
--- core_setup.sh.orig
+++ core_setup.sh
@@ At the top, add:
+INSTALL_DIR=${INSTALL_DIR:-/opt/openslides}
-# Log directory and file location
-SCRIPT_DIR=$(dirname "$(realpath "$0")")
-LOG_DIR="$SCRIPT_DIR/logs"
+LOG_DIR="$INSTALL_DIR/logs"
@@ In setup_openslides():
-if [ ! -f "/opt/openslides/openslides" ]; then
-    mkdir -p /opt/openslides || {
+if [ ! -f "$INSTALL_DIR/openslides" ]; then
+    mkdir -p "$INSTALL_DIR" || {
@@ Replace download target path:
-    wget -q https://github.com/OpenSlides/openslides-manage-service/releases/download/latest/openslides -O /opt/openslides/openslides || {
+    wget -q https://github.com/OpenSlides/openslides-manage-service/releases/download/latest/openslides -O "$INSTALL_DIR/openslides" || {
 
###############################################
# Patch for openslides_utils.sh
###############################################
--- openslides_utils.sh.orig
+++ openslides_utils.sh
@@ At the top, add:
+INSTALL_DIR=${INSTALL_DIR:-/opt/openslides}
-# Log directory and file location
-SCRIPT_DIR=$(dirname "$(realpath "$0")")
-LOG_DIR="$SCRIPT_DIR/logs"
+LOG_DIR="$INSTALL_DIR/logs"
@@ In all functions, replace hardcoded "/opt/openslides" with "$INSTALL_DIR"
-  pull_docker_images /opt/openslides/docker-compose.yml
+  pull_docker_images "$INSTALL_DIR/docker-compose.yml"
@@ And similarly for other commands using /opt/openslides
 
###############################################
# Patch for yml_fix.sh
###############################################
--- yml_fix.sh.orig
+++ yml_fix.sh
@@ At the top, add:
+INSTALL_DIR=${INSTALL_DIR:-/opt/openslides}
-# Log directory and file location
-SCRIPT_DIR=$(dirname "$(realpath "$0")")
-LOG_DIR="$SCRIPT_DIR/logs"
+LOG_DIR="$INSTALL_DIR/logs"
@@ In fix_docker_compose_yml():
-  local compose_file="/opt/openslides/docker-compose.yml"
+  local compose_file="$INSTALL_DIR/docker-compose.yml"
@@ Replace secrets directory path:
-  mkdir -p /opt/openslides/secrets || {
+  mkdir -p "$INSTALL_DIR/secrets" || {
-  sed -i 's|file: ./secrets/|file: /opt/openslides/secrets/|g' "$compose_file" || {
+  sed -i 's|file: ./secrets/|file: '"$INSTALL_DIR"'/secrets/|g' "$compose_file" || {
 
###############################################
# Patch for docker_utils.sh
###############################################
--- docker_utils.sh.orig
+++ docker_utils.sh
@@ At the top, add:
+INSTALL_DIR=${INSTALL_DIR:-/opt/openslides}
-# Log directory and file location
-SCRIPT_DIR=$(dirname "$(realpath "$0")")
-LOG_DIR="$SCRIPT_DIR/logs"
+LOG_DIR="$INSTALL_DIR/logs"
@@ In fix_docker_compose_version():
-  local compose_file="/opt/openslides/docker-compose.yml"
+  local compose_file="$INSTALL_DIR/docker-compose.yml"
